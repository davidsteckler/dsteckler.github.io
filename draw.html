<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Whiteboard</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#f5f5f5;overflow:hidden}
    .container{display:flex;flex-direction:column;height:100vh}
    .toolbar{display:flex;flex-wrap:wrap;gap:5px;padding:10px;background:#333;color:#fff;justify-content:space-between}
    .toolbar-section{display:flex;gap:5px;align-items:center}
    .board-container{flex-grow:1;position:relative;background:#fff;overflow:hidden}
    canvas{position:absolute;top:0;left:0;border:1px solid #ddd;background:#fff;cursor:crosshair}
    #grid-overlay{pointer-events:none;display:none}
    button{padding:8px 12px;border:none;border-radius:4px;background:#555;color:#fff;cursor:pointer;transition:.2s}
    button:hover{background:#777}
    button.active{background:#4caf50}
    input[type="color"]{width:40px;height:30px;border:none;background:none;cursor:pointer}
    input[type="range"]{width:100px}
    .color-preset{width:25px;height:25px;border-radius:50%;border:2px solid #555;cursor:pointer}
    .selected-color{border-color:#fff}
    #text-input{position:absolute;display:none;padding:5px;font-family:inherit;border:1px dashed #000;background:transparent;resize:none;overflow:hidden;outline:none}
    .tool-tip{position:relative}
    .tool-tip:hover::after{content:attr(data-tip);position:absolute;bottom:-30px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.8);color:#fff;padding:5px 10px;border-radius:4px;font-size:12px;white-space:nowrap;z-index:100}
    #status-bar{display:flex;justify-content:space-between;padding:5px 10px;background:#333;color:#fff;font-family:monospace}
    #notification{position:fixed;right:10px;top:60px;background:rgba(0,0,0,.7);color:#fff;padding:10px 15px;border-radius:5px;opacity:0;transition:.4s;z-index:1000}
  </style>
</head>
<body>
<div class="container">
  <div class="toolbar">
    <div class="toolbar-section">
      <button id="pencil" class="tool active tool-tip" data-tip="Pencil (P)">‚úèÔ∏è</button>
      <button id="brush" class="tool tool-tip" data-tip="Brush (B)">üñåÔ∏è</button>
      <button id="line" class="tool tool-tip" data-tip="Line (L)">üìè</button>
      <button id="rect" class="tool tool-tip" data-tip="Rectangle (R)">‚óªÔ∏è</button>
      <button id="circle" class="tool tool-tip" data-tip="Circle (C)">‚≠ï</button>
      <button id="text" class="tool tool-tip" data-tip="Text (T)">T</button>
      <button id="eraser" class="tool tool-tip" data-tip="Eraser (E)">üßΩ</button>
      <button id="select" class="tool tool-tip" data-tip="Select (S)">üîç</button>
    </div>
    <div class="toolbar-section">
      <input type="color" id="color-picker" value="#000000">
      <div class="color-preset selected-color" style="background:black" data-color="#000000"></div>
      <div class="color-preset" style="background:red" data-color="#ff0000"></div>
      <div class="color-preset" style="background:blue" data-color="#0000ff"></div>
      <div class="color-preset" style="background:green" data-color="#00ff00"></div>
      <div class="color-preset" style="background:yellow" data-color="#ffff00"></div>
    </div>
    <div class="toolbar-section">
      <span>Size:</span>
      <input type="range" id="size-slider" min="1" max="50" value="3">
    </div>
    <div class="toolbar-section" id="shape-controls" style="display:none">
      <span>Fill:</span><input type="checkbox" id="fill-shape">
      <span>Opacity:</span><input type="range" id="opacity-slider" min="0" max="100" value="100">
    </div>
    <div class="toolbar-section">
      <button id="clear">Clear</button>
      <button id="undo">Undo</button>
      <button id="redo">Redo</button>
      <button id="grid-toggle">Grid</button>
      <button id="save">Save</button>
    </div>
  </div>
  <div class="board-container" id="board-container">
    <canvas id="main-canvas"></canvas>
    <canvas id="grid-overlay"></canvas>
    <textarea id="text-input"></textarea>
  </div>
  <div id="status-bar"><span id="tool-status">Current Tool: Pencil</span><span id="canvas-position">Position: 0,0</span></div>
</div>
<div id="notification"></div>
<script>
(() => {
  const board = document.getElementById('board-container');
  const canvas = document.getElementById('main-canvas');
  const ctx = canvas.getContext('2d');
  const gridCanvas = document.getElementById('grid-overlay');
  const gridCtx = gridCanvas.getContext('2d');
  const textInput = document.getElementById('text-input');

  let isDrawing = false;
  let startX = 0, startY = 0;
  let shapes = [];
  let currentTool = 'pencil';
  let currentColor = '#000000';
  let brushSize = 3;
  let fillShape = false;
  let opacity = 1;
  let selectedShape = null;
  let history = [], step = -1;

  function resizeCanvas() {
    canvas.width = board.clientWidth;
    canvas.height = board.clientHeight;
    gridCanvas.width = canvas.width;
    gridCanvas.height = canvas.height;
    redraw();
    drawGrid();
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function saveHistory() {
    history = history.slice(0, step + 1);
    history.push(JSON.stringify(shapes));
    step++;
    if (history.length > 50) {
      history.shift();
      step--;
    }
  }
  function undo() {
    if (step > 0) {
      step--;
      shapes = JSON.parse(history[step]);
      selectedShape = null;
      redraw();
    }
  }
  function redo() {
    if (step < history.length - 1) {
      step++;
      shapes = JSON.parse(history[step]);
      selectedShape = null;
      redraw();
    }
  }

  document.getElementById('undo').addEventListener('click', undo);
  document.getElementById('redo').addEventListener('click', redo);
  document.getElementById('clear').addEventListener('click', () => {
    if (confirm('Clear the board?')) {
      shapes = [];
      saveHistory();
      selectedShape = null;
      redraw();
    }
  });

  document.getElementById('color-picker').addEventListener('input', e => {
    currentColor = e.target.value;
    document.querySelectorAll('.color-preset').forEach(p => p.classList.remove('selected-color'));
  });
  document.querySelectorAll('.color-preset').forEach(p => {
    p.addEventListener('click', () => {
      currentColor = p.dataset.color;
      document.getElementById('color-picker').value = currentColor;
      document.querySelectorAll('.color-preset').forEach(q => q.classList.remove('selected-color'));
      p.classList.add('selected-color');
    });
  });

  document.getElementById('size-slider').addEventListener('input', e => brushSize = +e.target.value);
  document.getElementById('fill-shape').addEventListener('change', e => fillShape = e.target.checked);
  document.getElementById('opacity-slider').addEventListener('input', e => opacity = +e.target.value / 100);

  document.getElementById('grid-toggle').addEventListener('click', () => {
    gridCanvas.style.display = gridCanvas.style.display === 'none' ? 'block' : 'none';
    drawGrid();
  });
  document.getElementById('save').addEventListener('click', () => {
    const prev = gridCanvas.style.display;
    gridCanvas.style.display = 'none';
    const link = document.createElement('a');
    link.download = 'whiteboard.png';
    canvas.toBlob(blob => {
      link.href = URL.createObjectURL(blob);
      link.click();
      gridCanvas.style.display = prev;
    });
  });

  document.addEventListener('keydown', e => {
    if (currentTool === 'text' && textInput.style.display === 'block') return;
    if (e.key === 'Backspace' || e.key === 'Delete') {
      if (selectedShape) {
        shapes = shapes.filter(s => s !== selectedShape);
        selectedShape = null;
        saveHistory();
        redraw();
      }
    }
  });

  canvas.addEventListener('mousedown', e => {
    const rect = canvas.getBoundingClientRect();
    startX = e.clientX - rect.left;
    startY = e.clientY - rect.top;
    isDrawing = true;
    if (currentTool === 'text') {
      textInput.style.display = 'block';
      textInput.style.left = startX + 'px';
      textInput.style.top = startY + 'px';
      textInput.style.color = currentColor;
      textInput.style.fontSize = brushSize * 5 + 'px';
      textInput.focus();
      return;
    }
  });

  canvas.addEventListener('mousemove', e => {
    if (!isDrawing) return;
    // implement drawing logic
  });

  canvas.addEventListener('mouseup', e => {
    isDrawing = false;
    if (currentTool === 'text') return;
    // finish drawing shape
    saveHistory();
    redraw();
  });

  document.addEventListener('click', e => {
    if (textInput.style.display === 'block' && !textInput.contains(e.target)) {
      const txt = textInput.value.trim();
      if (txt) {
        shapes.push({type:'text', x: startX, y: startY, text: txt, color: currentColor, fontSize: brushSize * 5});
        saveHistory();
        redraw();
      }
      textInput.style.display = 'none';
    }
  });

  function redraw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    shapes.forEach(s => {
      ctx.fillStyle = s.color;
      ctx.font = s.fontSize + 'px Arial';
      ctx.fillText(s.text, s.x, s.y);
    });
  }

  function drawGrid() {
    gridCtx.clearRect(0, 0, gridCanvas.width, gridCanvas.height);
    gridCtx.strokeStyle = '#ddd';
    gridCtx.lineWidth = 0.5;
    for (let x = 0; x <= gridCanvas.width; x += gridSize) {
      gridCtx.beginPath(); gridCtx.moveTo(x, 0); gridCtx.lineTo(x, gridCanvas.height); gridCtx.stroke();
    }
    for (let y = 0; y <= gridCanvas.height; y += gridSize) {
      gridCtx.beginPath(); gridCtx.moveTo(0, y); gridCtx.lineTo(gridCanvas.width, y); gridCtx.stroke();
    }
  }

  saveHistory();
})();
</script>
</body>
</html>
